<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>成员管理</title>
  <style>
    :root {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
      color: #0f172a;
      background-color: #f8fafc;
    }

    body {
      margin: 0;
      padding: 2rem;
    }

    .container {
      max-width: 960px;
      margin: 0 auto;
    }

    h1 {
      font-size: 2rem;
      margin-bottom: 1rem;
    }

    .cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    .card {
      background: #fff;
      padding: 1.5rem;
      border-radius: 12px;
      box-shadow: 0 10px 25px rgba(15, 23, 42, 0.08);
    }

    label {
      display: block;
      font-weight: 600;
      margin-bottom: 0.35rem;
    }

    input,
    select {
      width: 100%;
      padding: 0.5rem 0.75rem;
      border-radius: 8px;
      border: 1px solid #cbd5f5;
      font-size: 0.95rem;
      margin-bottom: 1rem;
    }

    button {
      background-color: #2563eb;
      color: #fff;
      border: none;
      padding: 0.65rem 1.4rem;
      border-radius: 999px;
      font-size: 0.95rem;
      cursor: pointer;
    }

    button:hover {
      background-color: #1d4ed8;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: #fff;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 10px 25px rgba(15, 23, 42, 0.08);
    }

    thead {
      background: #eff6ff;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      font-size: 0.8rem;
    }

    th,
    td {
      padding: 0.875rem 1rem;
      text-align: left;
    }

    tbody tr:nth-child(odd) {
      background: #f8fafc;
    }

    .delete-btn {
      background: transparent;
      color: #ef4444;
      border: 1px solid #fecaca;
      padding: 0.35rem 0.9rem;
      border-radius: 999px;
    }

    .delete-btn:hover {
      background: #fee2e2;
    }

    .empty {
      text-align: center;
      padding: 1.5rem;
      color: #94a3b8;
    }

    .notice {
      margin-top: 1rem;
      color: #16a34a;
      min-height: 1.25rem;
    }

    .error {
      color: #dc2626;
    }

    .github-profile {
      display: flex;
      gap: 1rem;
      margin-top: 1rem;
      align-items: center;
    }

    .github-profile.hidden {
      display: none;
    }

    .github-avatar {
      width: 64px;
      height: 64px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid #e2e8f0;
    }

    .github-meta {
      line-height: 1.4;
    }
  </style>
</head>

<body>
  <main class="container">
    <h1>团队成员管理</h1>
    <div class="cards">
      <section class="card">
        <h2>新增成员</h2>
        <form id="member-form">
          <label for="name">姓名</label>
          <input id="name" name="name" required placeholder="如：张三" />

          <label for="email">邮箱</label>
          <input id="email" name="email" type="email" required placeholder="name@example.com" />

          <label for="role">角色</label>
          <select id="role" name="role">
            <option value="产品">产品</option>
            <option value="研发">研发</option>
            <option value="运营">运营</option>
            <option value="设计">设计</option>
          </select>

          <button type="submit">添加</button>
          <p class="notice" id="form-notice"></p>
        </form>
      </section>

      <section class="card">
        <h2>GitHub 用户信息</h2>
        <form id="github-form">
          <label for="github-token">个人 Token</label>
          <input id="github-token" name="token" placeholder="ghp_xxx" required />

          <button type="submit">获取信息</button>
          <p class="notice" id="github-notice"></p>
        </form>

        <div id="github-profile" class="github-profile hidden">
          <img id="github-avatar" class="github-avatar" alt="avatar" />
          <div class="github-meta">
            <div><strong id="github-name"></strong> (@<span id="github-login"></span>)</div>
            <div id="github-bio"></div>
            <div>
              <span id="github-followers"></span> ·
              <span id="github-following"></span> ·
              <span id="github-repos"></span>
            </div>
            <a id="github-link" href="#" target="_blank" rel="noreferrer">访问 GitHub</a>
          </div>
        </div>
      </section>
    </div>

    <section>
      <table>
        <thead>
          <tr>
            <th>ID</th>
            <th>姓名</th>
            <th>邮箱</th>
            <th>角色</th>
            <th>操作</th>
          </tr>
        </thead>
        <tbody id="member-body">
          <tr>
            <td class="empty" colspan="5">加载中...</td>
          </tr>
        </tbody>
      </table>
    </section>
  </main>

  <script>
    const API_URL = '/items';
    const GITHUB_API_URL = '/github/profile';
    const bodyEl = document.getElementById('member-body');
    const formEl = document.getElementById('member-form');
    const noticeEl = document.getElementById('form-notice');
    const githubForm = document.getElementById('github-form');
    const githubTokenInput = document.getElementById('github-token');
    const githubNotice = document.getElementById('github-notice');
    const githubProfile = document.getElementById('github-profile');
    const githubAvatar = document.getElementById('github-avatar');
    const githubName = document.getElementById('github-name');
    const githubLogin = document.getElementById('github-login');
    const githubBio = document.getElementById('github-bio');
    const githubFollowers = document.getElementById('github-followers');
    const githubFollowing = document.getElementById('github-following');
    const githubRepos = document.getElementById('github-repos');
    const githubLink = document.getElementById('github-link');

    const setNotice = (message, isError = false) => {
      noticeEl.textContent = message;
      noticeEl.classList.toggle('error', isError);
    };

    const renderRows = (items) => {
      if (!items.length) {
        bodyEl.innerHTML = '<tr><td class="empty" colspan="5">暂无成员</td></tr>';
        return;
      }

      bodyEl.innerHTML = items
        .map(
          (item) => `
            <tr>
              <td>${item.id}</td>
              <td>${item.name}</td>
              <td>${item.email}</td>
              <td>${item.role}</td>
              <td>
                <button class="delete-btn" data-id="${item.id}">删除</button>
              </td>
            </tr>`
        )
        .join('');
    };

    const fetchItems = async () => {
      try {
        const res = await fetch(API_URL);
        const data = await res.json();
        renderRows(data);
      } catch (error) {
        bodyEl.innerHTML = '<tr><td class="empty" colspan="5">加载失败</td></tr>';
      }
    };

    formEl.addEventListener('submit', async (event) => {
      event.preventDefault();
      const formData = new FormData(formEl);
      const payload = Object.fromEntries(formData.entries());

      try {
        const res = await fetch(API_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload),
        });

        if (!res.ok) throw new Error('保存失败');
        formEl.reset();
        setNotice('保存成功');
        fetchItems();
      } catch (error) {
        setNotice(error.message || '保存失败', true);
      }
    });

    bodyEl.addEventListener('click', async (event) => {
      if (event.target.matches('.delete-btn')) {
        const id = event.target.getAttribute('data-id');
        if (!id) return;
        const confirmDelete = confirm('确认删除该成员吗？');
        if (!confirmDelete) return;

        try {
          const res = await fetch(`${API_URL}/${id}`, { method: 'DELETE' });
          if (!res.ok) throw new Error('删除失败');
          fetchItems();
        } catch (error) {
          alert(error.message || '删除失败');
        }
      }
    });

    fetchItems();

    const setGithubNotice = (message, isError = false) => {
      githubNotice.textContent = message;
      githubNotice.classList.toggle('error', isError);
    };

    const renderGithubProfile = (profile) => {
      githubAvatar.src = profile.avatarUrl;
      githubAvatar.alt = profile.login;
      githubName.textContent = profile.name || '未填写昵称';
      githubLogin.textContent = profile.login;
      githubBio.textContent = profile.bio || '暂无简介';
      githubFollowers.textContent = `粉丝 ${profile.followers}`;
      githubFollowing.textContent = `关注 ${profile.following}`;
      githubRepos.textContent = `公开仓库 ${profile.publicRepos}`;
      githubLink.href = profile.profileUrl;
      githubProfile.classList.remove('hidden');
    };

    githubForm.addEventListener('submit', async (event) => {
      event.preventDefault();
      const token = githubTokenInput.value.trim();
      if (!token) {
        setGithubNotice('请填写 GitHub Token', true);
        return;
      }

      setGithubNotice('查询中...');
      githubProfile.classList.add('hidden');

      try {
        const res = await fetch(GITHUB_API_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ token }),
        });

        const data = await res.json();
        if (!res.ok) {
          throw new Error(data.message || '查询失败');
        }

        renderGithubProfile(data);
        setGithubNotice('查询成功');
      } catch (error) {
        setGithubNotice(error.message || '查询失败', true);
      }
    });
  </script>
</body>

</html>